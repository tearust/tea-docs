# The TEA Project's Two Layer Setup for Fast Dapps 

**TEA** stands for **Trusted Execution** and **Attestation**. This trusted execution and attestation plays out across two different layers and three separate roots of trust.

The TEA Project features two different layers: a layer-1 (Ethereum) that uses blockchain and a layer-2 that uses time for non-traditional consensus. TEA's layer-2 nodes run on top of blockchain while utilizing the IPFS peer-to-peer filesytem and trusted hardware (TPM and GPS modules). Combining these technologies allows the TEA Project to scale without compromising security or decentralization.

In brief, we can say that the layer-1 blockchain we use, Ethereum, keeps the trust data on the layer-2 mining nodes. Its main job is to ensure that all layer-2 nodes are trustable. Because all layer-2 nodes are trustable (as determined by Ethereum’s layer-1 consensus), we no longer have to worry about Byzantine faults on layer-2. Another of the TEA Project's roots of trust, time, ensures that the layer-2 transactions are always properly ordered in our state machine. Because of this two-layer design, our second compute layer can have potentially limitless TPS as it's not burdened with slow, BFT-based consensus.

We use the layer-1 (Ethereum) consensus not to confirm the result of the dApp's code; we instead use the consensus to verify the execution environment where the code was run. The TEA Project's philosophy is that if the execution environment, code, and input data are trusted, then the execution result can also be trusted. 

The TEA Project aims to build a platform that allows code and data to run inside TEA nodes with complete trust. The technologies built into the TEA platform protects the data and makes sure: 

- The computation is based on the expected code and expected data. No one can alter the input code, the input data, or the output result. 
- Anyone outside the TEA module's hardware has no access to what's inside the module.
- After the task is done, anyone can verify the Proof of Trust data of how their code or data was processed. 

## A Summary of How TEA Project Uses Its Layer-1 
TEA uses its layer-1 blockchain to provide: 

- Economic incentives and penalties that form the basis of its token economy.  
- Immutable trust information storage, such as credit history (incentives and penalties for nodes governed by smart contracts) as well as Proof of Trust (PoT) information (key IDs, and hashes).

Let’s take a closer look at the PoT information that TEA keeps on its layer-1 blockchain.

- The layer-1 blockchain keeps the trust data on the layer-2 mining nodes to ensure that all layer-2 nodes are trustable. 
- Each layer-2 node must be in good standing based on the information reported by the node's TPM chip under the watch of remote attestation.
- Because all layer-2 nodes are trustable (as determined by our layer-1 consensus), we no longer have to worry about Byzantine faults on layer-2. There's no traditional consensus needed on layer-2. The second root of trust for our layer-2, time, ensures that transactions are always properly ordered in our state machine.

## Remote Attestation 

The immutable trust information stored in TEA's layer-1 blockchain is used in the remote attestation process. This process is used in conjunction with the TPM chips onboard the mining computers to ensure each node is trustable: 

- Multiple nodes are randomly called to conduct remote attestation on any particular node under inspection. 
- The results of these remote attestations are stored in the layer-1 blockchain as Proof of Trust (PoT) data. 
- Successful remote attestation on a candidate node ensures that the machine's TPM chip hasn't been tampered with. Therefore, the secure enclave overseen by the TPM chip is trustable and will protect the confidentiality of both the code and data processed within the enclave. 

It’s through this remote attestation process that the TEA Project has been able to create a completely trustable peer-to-peer network of layer-2 nodes that are protected and monitored by a hardware TPM chip providing PoT (Proof of Trust) data. Every TEA node can verify any other TEA node's integrity through a remote attestation process. The verification is controlled and determined by blockchain smart contracts.

This is the fundamental premise of the TEA Project's concept of trust. If a node shows full integrity under remote attestations performed by multiple peer nodes, then its enclave is secure, and the resulting calculations (i.e. app output) can be trusted. 

## How TEA's Layer-1 Conducts Remote Attestation 
In the TEA network, each trusted computing node has a Root of Trust (RoT), a key pair generated by the TPM manufacturer. The private key for this RoT is held inside the hardware and not known to anyone, including the manufacturer. The public key is disclosed and recorded on the blockchain. Periodically, the blockchain will run remote attestation by requesting a computational node to generate its hardware fingerprint and fingerprints for all the software modules running in the node. These will need to be signed by the TPM's private key before being returned as a response to the attestation request. Each attesting node would verify the signature and the Proof of Trust (PoT) data returned. 

TEA's layer-1 consensus protocol randomly selects remote attestation nodes on layer-2 to challenge the randomly selected node (also on layer-2) being tested. If a two-thirds (2/3) majority of remote attestation nodes receive a positive result from verifying the target node's requested attestation material, the tested node will have passed the consensus verification and be marked as trustable to use. Note that trustable nodes are the only ones selectable to perform the remote attestation process. Therefore, as long as the network can keep a minimum ratio of 2/3 trustable nodes, we can trust the consensus result. To maintain this minimum threshold, the TEA Project team will initially bootstrap the network with clean nodes and control the birth rate of new nodes by controlling the issuance of Camellia NFTs needed to run nodes on the TEA network. 

The results from all attesting nodes will run through the blockchain's consensus protocol before a final decision is made on whether the computing node still meets all the security requirements for it to remain on the network. Finally, the result of the attestation process is recorded on the layer-1 blockchain. 

The different layers of software running in the computational node generate their own secrets, one after another, each using the parent layer's key pairs so that all of them can pass cryptographic verification. These nodes together form a trust chain, with the root of the chain being the hardware RoT. Because the public key of the RoT is stored in the blockchain publicly, anyone can easily verify any derived secrets by tracing back the chain of trust and confirming the RoT using data recorded on the blockchain. 
