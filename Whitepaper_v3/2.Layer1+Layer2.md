# The TEA Project's Two Layer Setup for Fast Dapps 

**TEA** stands for **Trusted Execution** and **Attestation**. This trusted execution and attestation plays out across two different layers and three separate roots of trust.

The TEA Project features two different layers: a layer-1 (Ethereum) that uses blockchain and a layer-2 that uses time for non-traditional consensus. TEA's layer-2 nodes run on top of blockchain while utilizing the IPFS peer-to-peer filesytem and trusted hardware (TPM and GPS modules). Combining these technologies allows the TEA Project to scale without compromising security or decentralization.

In brief, we can say that the layer-1 blockchain we use, Ethereum, keeps the trust status of each layer-2 mining nodes. Any layer-2 nodes deemed not trustable will not be allowed to run on our compute layer (layer-2). We don't use the layer-1 to confirm the result of the dApp's code; we instead run  consensus through remote attestation on layer-2 to verify the execution environment where the code was run. The TEA Project's philosophy is that if the execution environment, code, and input data are trusted, then the execution result can also be trusted. Our layer-1 is currently Ethereum but TEA's layer-2 can be run on top of any smart contract-based blockchain.

The TEA Project aims to build a platform that allows code and data to run inside TEA nodes with complete trust. The technologies built into the TEA platform protects the data and makes sure: 

- The computation is based on the expected code and expected data. No one can alter the input code, the input data, or the output result. 
- Anyone outside the TEA module's hardware has no access to what's inside the module.
- After the task is done, anyone can verify the Proof of Trust data of how their code or data was processed. 

## A Summary of How TEA Project Uses Its Layer-1 
TEA uses its layer-1 blockchain to provide: 

- Economic incentives and penalties that form the basis of its token economy.
- Trust information storage written to the CML NFTs's metadata (ERC-721).

Let’s take a closer look at the PoT information that TEA keeps on its layer-1 blockchain.

- The layer-1 blockchain keeps the trust data on the layer-2 mining nodes to ensure that all layer-2 nodes are trustable. 
- Each layer-2 node must be in good standing based on the information reported by the node's TPM chip under the watch of remote attestation.
- Because all layer-2 nodes are trustable (as determined by our layer-1 consensus), we no longer have to worry about Byzantine faults on layer-2. There's no traditional consensus needed on layer-2. The second root of trust for our layer-2, time, ensures that transactions are always properly ordered in our state machine.

## Remote Attestation 

The immutable trust information stored in TEA's layer-1 blockchain is used in the remote attestation process. This process is used in conjunction with the hardware security modules (HSM) onboard the mining computers to ensure each node is trustable. 

- Multiple nodes are randomly called to conduct remote attestation on any particular node under inspection. 
- The results of these remote attestations are stored in the layer-2 database. 
- Successful remote attestation on a candidate node ensures that the machine's HSM hasn't been tampered with. Therefore, the secure enclave overseen by the HSM is trustable and will protect the confidentiality of both the code and data processed within the enclave. 

It’s through this remote attestation process that the TEA Project has been able to create a completely trustable peer-to-peer network of layer-2 nodes that are protected and monitored by hardware TPM chips. Every TEA node can verify any other TEA node's integrity through a remote attestation process. 

This is the fundamental premise of the TEA Project's concept of trust. If a node shows full integrity under remote attestations performed by multiple peer nodes, then its enclave is secure, and the resulting calculations (i.e. app output) can be trusted. 

## How TEA Conducts Remote Attestation 
In the TEA network, each trusted computing node has a Root of Trust (RoT), a key pair generated by the HSM manufacturer. The private key for this RoT is held inside the hardware and not known to anyone, including the manufacturer. The public key is recorded in a database on TEA's layer-2. 

TEA Project currently runs on AWS Nitro for its compute nodes. Unlike hardware TPM chips that generate Proof of Trust data, the remote attestation process will involve interacting with the KMS of each Nitro instance. The process of remote attestation of AWS Nitro nodes proceeds as follows:

1. Periodically, the TEA Project's layer-2 will select a random node to run remote attestation on. It will request:

- The node's KMS to generate its attestation document.
- Request the node to generate its hardware fingerprint and fingerprints for all the software modules running in the node. These will need to be signed by the Nitro node's private key before being returned as a response to the attestation request. 

2. The attestor will compare the KMS-generated attestation document to the hardware fingerprints claimed by the software (TEA runtime) running in the node. Each attesting node:

- Verifies the signature of the attestation documents.
- Verifies that the two attestation documents have no discrepancies for the hardware fingerprints.

3. TEA's layer-2 uses a Raft consensus protocol where a leader node randomly selects remote attestation nodes on layer-2 to challenge the randomly selected node (also on layer-2) being tested. If a two-thirds (2/3) majority of attestor nodes (including the leader) receive a positive result from verifying the target node's requested attestation material, the tested node will have passed the consensus verification and be marked as trustable to use. Note that trustable nodes are the only ones selectable to perform the remote attestation process. Therefore, as long as the network can keep a minimum ratio of 2/3 trustable nodes, we can trust the consensus result. To maintain this minimum threshold, the TEA Project team will initially bootstrap the network with clean nodes and control the birth rate of new nodes by controlling the issuance of Camellia NFTs needed to run nodes on the TEA network. 

4. Finally, the result of the attestation process is recorded on the layer-1 blockchain. 

- If attestation passed, the result will be written to the CML NFT's metadata (ERC-721).
- If attestation failed, the result will be written to the CML NFT's metadata (ERC-721).

In the event that a CML is marked as failing remote attestation, it will no longer be allowed to run on TEA's layer-2 and its bonding curve tokens will be slashed to 0 and forfeited by all of its owners.
